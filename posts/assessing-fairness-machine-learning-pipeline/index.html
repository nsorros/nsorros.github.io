<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Assesing the fairness of our machine learning pipeline | Nick Sorros</title><meta name=keywords content="machine learning,fairness"><meta name=description content="My day to day job is to develop technologies that automate different processes at Wellcome through data science and machine learning. As a builder of these digital products, my team and I have to consider the unintended consequences they may have on users and on society more broadly. We know this is important because of famous cases where the consequences weren’t considered and harm has been done. For example the Google photos tagging system and Amazon hiring algorithm that have been accused of unintended racist and sexist bias."><meta name=author content><link rel=canonical href=https://nsorros.github.io/posts/assessing-fairness-machine-learning-pipeline/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://nsorros.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nsorros.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://nsorros.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://nsorros.github.io/apple-touch-icon.png><link rel=mask-icon href=https://nsorros.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Assesing the fairness of our machine learning pipeline"><meta property="og:description" content="My day to day job is to develop technologies that automate different processes at Wellcome through data science and machine learning. As a builder of these digital products, my team and I have to consider the unintended consequences they may have on users and on society more broadly. We know this is important because of famous cases where the consequences weren’t considered and harm has been done. For example the Google photos tagging system and Amazon hiring algorithm that have been accused of unintended racist and sexist bias."><meta property="og:type" content="article"><meta property="og:url" content="https://nsorros.github.io/posts/assessing-fairness-machine-learning-pipeline/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-10T10:10:30+03:00"><meta property="article:modified_time" content="2020-03-10T10:10:30+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Assesing the fairness of our machine learning pipeline"><meta name=twitter:description content="My day to day job is to develop technologies that automate different processes at Wellcome through data science and machine learning. As a builder of these digital products, my team and I have to consider the unintended consequences they may have on users and on society more broadly. We know this is important because of famous cases where the consequences weren’t considered and harm has been done. For example the Google photos tagging system and Amazon hiring algorithm that have been accused of unintended racist and sexist bias."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://nsorros.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Assesing the fairness of our machine learning pipeline","item":"https://nsorros.github.io/posts/assessing-fairness-machine-learning-pipeline/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Assesing the fairness of our machine learning pipeline","name":"Assesing the fairness of our machine learning pipeline","description":"My day to day job is to develop technologies that automate different processes at Wellcome through data science and machine learning. As a builder of these digital products, my team and I have to consider the unintended consequences they may have on users and on society more broadly. We know this is important because of famous cases where the consequences weren’t considered and harm has been done. For example the Google photos tagging system and Amazon hiring algorithm that have been accused of unintended racist and sexist bias.","keywords":["machine learning","fairness"],"articleBody":"My day to day job is to develop technologies that automate different processes at Wellcome through data science and machine learning. As a builder of these digital products, my team and I have to consider the unintended consequences they may have on users and on society more broadly. We know this is important because of famous cases where the consequences weren’t considered and harm has been done. For example the Google photos tagging system and Amazon hiring algorithm that have been accused of unintended racist and sexist bias. At Wellcome Data Labs we are developing an agile way of assessing the ethics and fairness behind the tools that we build. We hope that this will help us to anticipate the potential harm of our products so we can avoid causing it in the first place\nOne particular technology that has been in the spotlight lately is machine learning. This is for two main reasons. Firstly, machine learning can replicate and augment human biases that may be hidden in the data that the algorithm is trained on. Secondly the decisions made by machine learning algorithms are often black boxes — meaning that it is hard to decipher how the decision is made. This is particularly problematic when the decision that is being automated using machine learning has to do with a human, such as whether someone should get a loan or be released early from prison. At Wellcome Data Labs we work in a less risky environment and none of the decisions we automate are as life changing as these examples. We also use a form of machine learning (Natural Language Processing or NLP) where to best of our knowledge there have been fewer known incidents of bias.\nOur product — Reach Our product Reach is a tool that helps researchers, policy makers and funders better understand how scientific research is used in policy. Reach consists of a pipeline of machine learning algorithms each of which could introduce bias into the product. As such we wanted to assess whether any of the algorithms contained any detectable bias and then take steps to mitigate it. Conceptually, what Reach does is very simple; the pipeline of algorithms finds reference sections in the text of policy documents and turns them into structured references. There is one algorithm for splitting references, one for extracting the individual parts of a reference -such as title, author, etc. — and one for matching references with a database of known publications.\nWe decided to start our ethical evaluation on the algorithm that is responsible for extracting titles from the references. While we were aware that we could find bias in any part of the reference, i.e. the journal title, publication type, year, etc., we focussed on titles. This is because we use titles to cross-reference the output of the algorithmic pipeline.\nDefining fairness mathematically To evaluate fairness we first need to define what we mean by ‘fairness’ and then find an appropriate metric to measure it in our product. There is no shortage of definitions of fairness, but we wanted to focus on group fairness which quantifies fairness in a group rather than at an individual level. For group fairness, there were a few definitions which we could have used.\nAn example would be demographic parity which would mean that we would need to extract an equal number of titles per group, for example per gender or journal. This would not make sense in our case since the distribution of authors or journals is not always 50/50. A particularly problematic definition is accuracy parity which asks if the algorithm makes the same number of mistakes per group. As long as the algorithm makes the same number of mistakes irrespective of the type, the algorithm shows accuracy parity and is ‘fair’. To understand why this is an issue, we first need to understand more about the types of mistakes an algorithm can make.\nTypes of mistakes There are two different types of mistakes that someone might look to equalise across groups: false positives and false negatives. In our example of an algorithm that decides if people should get a loan, false positives are when the algorithm wrongly gives someone a loan and false negatives are when the algorithm decides someone shouldn’t have a loan when they should. There are also two different types of correct predictions that we might want to equalise: true positives and true negatives. In the same example true positives is when the algorithm correctly predicts that someone should get a loan and true negatives when a loan is not being given to someone that would not repay it. It is important to note that it has been proven that optimising for all metrics is mathematically impossible except for some rare occasions. This means that the algorithm will always be ‘unfair’ by some definition, which is why it is so important to prioritise the type of error that would be most harmful in each specific context.\nThe right metric depends on the context False positives might be more important in hiring- where the error of hiring the wrong person is difficult to correct- whereas false negatives are crucial in medical diagnosis. For Reach, we decided to prioritise true positive rate because we want to ensure that we extract titles equally accurately across all groups. We have decided this to avoid the hypothetical situation where we would be reinforcing a societal bias towards rewarding citations to a particular group more. Every metric is a trade off, and no one metric can capture everything. In the case of true positive rate, the metric misses out at over attribution. This is when parts of the reference which aren’t titles (e.g. names or dates) are being misclassified as titles and then spuriously matched with publications which generates false citations…\nThe groups The last piece missing before applying our definition of fairness to our context is a decision about the groups that are relevant. These groups people usually focus on when looking at fairness are often around protected characteristics such as gender and race. Like the definition of fairness, the specific groups to focus on also depend on the context of the decision that is being made by the algorithm. In the case of scientific publications, we decided to start by looking in the nationalities of the authors, the publication type (e.g. journal, conference, etc), the field (e.g. sociology, genetics etc), the university and the language of publication among others. This is because we do not want to favour any particular field, university or language when attributing policy citations.\nThe findings, some limitations and iterations for the future When we did the analysis, there was no sign of bias in any of the groups we had chosen because the difference in true positive rate was negligible. There was a noticeable difference of ~3% favouring English publications which is not very surprising given that most of the training data were in English. We did not consider this difference was important to act upon, but the fact that we could detect it was a positive sign.\nThere are more things that we would like to review and improve in our evaluations of fairness. For example, the dataset on top of which we did the review was not independent nor balanced for the groups we were testing which means that our estimates for some groups are based on very small sample sizes. At the same time the dataset had already been ‘seen’ by the algorithm when we were training it. In future, it is more appropriate to calculate our metrics on an independent test set. We have also only evaluated one component of our machine learning pipeline and we know that attributing citations is a complex system that would be better evaluated end to end. One other thing to note is that evaluating some groups might require us to use yet another machine learning model to predict something like language, which would then need to be evaluated independently for its own biases to make sure we are reaching the right conclusions.\nWe are still in the early days of working out the details of how to embed ethics in an agile team in order to reduce the risk of negative consequences from the digital products we built but we feel we have learned a lot just by devoting the time and energy to think and do this. We will be sharing more from this journey as we refine these processes and do more evaluations. In the meantime if you have any questions or comments do not hesitate to get in touch.\n","wordCount":"1436","inLanguage":"en","datePublished":"2020-03-10T10:10:30+03:00","dateModified":"2020-03-10T10:10:30+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://nsorros.github.io/posts/assessing-fairness-machine-learning-pipeline/"},"publisher":{"@type":"Organization","name":"Nick Sorros","logo":{"@type":"ImageObject","url":"https://nsorros.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nsorros.github.io accesskey=h title="Nick Sorros (Alt + H)">Nick Sorros</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://nsorros.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nsorros.github.io>Home</a>&nbsp;»&nbsp;<a href=https://nsorros.github.io/posts/>Posts</a></div><h1 class=post-title>Assesing the fairness of our machine learning pipeline</h1><div class=post-meta><span title='2020-03-10 10:10:30 +0300 +0300'>March 10, 2020</span>&nbsp;·&nbsp;7 min</div></header><div class=post-content><p>My day to day job is to develop technologies that automate different processes at Wellcome through data science and machine learning. As a builder of these digital products, my team and I have to consider the unintended consequences they may have on users and on society more broadly. We know this is important because of famous cases where the consequences weren’t considered and harm has been done. For example the <a href=https://www.theverge.com/2018/1/12/16882408/google-racist-gorillas-photo-recognition-algorithm-ai>Google photos tagging system</a> and <a href=https://www.reuters.com/article/us-amazon-com-jobs-automation-insight/amazon-scraps-secret-ai-recruiting-tool-that-showed-bias-against-women-idUSKCN1MK08G>Amazon hiring algorithm</a> that have been accused of unintended racist and sexist bias. At Wellcome Data Labs we are developing an agile way of assessing the ethics and fairness behind the tools that we build. We hope that this will help us to anticipate the potential harm of our products so we can avoid causing it in the first place</p><p>One particular technology that has been in the spotlight lately is machine learning. This is for two main reasons. Firstly, machine learning can replicate and augment human biases that may be hidden in the data that the algorithm is trained on. Secondly the decisions made by machine learning algorithms are often black boxes — meaning that it is hard to decipher how the decision is made. This is particularly problematic when the decision that is being automated using machine learning has to do with a human, such as whether someone should get a loan or be released early from prison. At Wellcome Data Labs we work in a less risky environment and none of the decisions we automate are as life changing as these examples. We also use a form of machine learning (Natural Language Processing or NLP) where to best of our knowledge there have been fewer known incidents of bias.</p><h2 id=our-product--reach>Our product — Reach<a hidden class=anchor aria-hidden=true href=#our-product--reach>#</a></h2><p>Our product <a href=https://github.com/wellcometrust/reach>Reach</a> is a tool that helps researchers, policy makers and funders better understand how scientific research is used in policy. Reach consists of a pipeline of machine learning algorithms each of which could introduce bias into the product. As such we wanted to assess whether any of the algorithms contained any detectable bias and then take steps to mitigate it. Conceptually, what Reach does is very simple; the pipeline of algorithms finds reference sections in the text of policy documents and turns them into structured references. There is one algorithm for splitting references, one for extracting the individual parts of a reference -such as title, author, etc. — and one for matching references with a database of known publications.</p><p> 
<img loading=lazy src=/images/reference-extraction-pipeline.png#center alt=reference-extraction-pipeline>
 </p><p>We decided to start our ethical evaluation on the algorithm that is responsible for extracting titles from the references. While we were aware that we could find bias in any part of the reference, i.e. the journal title, publication type, year, etc., we focussed on titles. This is because we use titles to cross-reference the output of the algorithmic pipeline.</p><h2 id=defining-fairness-mathematically>Defining fairness mathematically<a hidden class=anchor aria-hidden=true href=#defining-fairness-mathematically>#</a></h2><p>To evaluate fairness we first need to define what we mean by ‘fairness’ and then find an appropriate metric to measure it in our product. There is no shortage of definitions of fairness, but we wanted to focus on group fairness which quantifies fairness in a group rather than at an individual level. For group fairness, there were a few definitions which we could have used.</p><p>An example would be demographic parity which would mean that we would need to extract an equal number of titles per group, for example per gender or journal. This would not make sense in our case since the distribution of authors or journals is not always 50/50. A particularly problematic definition is accuracy parity which asks if the algorithm makes the same number of mistakes per group. As long as the algorithm makes the same number of mistakes irrespective of the type, the algorithm shows accuracy parity and is ‘fair’. To understand why this is an issue, we first need to understand more about the types of mistakes an algorithm can make.</p><h2 id=types-of-mistakes>Types of mistakes<a hidden class=anchor aria-hidden=true href=#types-of-mistakes>#</a></h2><p>There are two different types of mistakes that someone might look to equalise across groups: false positives and false negatives. In our example of an algorithm that decides if people should get a loan, false positives are when the algorithm wrongly gives someone a loan and false negatives are when the algorithm decides someone shouldn’t have a loan when they should. There are also two different types of correct predictions that we might want to equalise: true positives and true negatives. In the same example true positives is when the algorithm correctly predicts that someone should get a loan and true negatives when a loan is not being given to someone that would not repay it. It is important to note that it has been proven that optimising for all metrics is mathematically impossible except for some rare occasions. This means that the algorithm will always be ‘unfair’ by some definition, which is why it is so important to prioritise the type of error that would be most harmful in each specific context.</p><p> 
<img loading=lazy src=/images/confusion-matrix.png#center alt=confusion-matrix>
 </p><h2 id=the-right-metric-depends-on-the-context>The right metric depends on the context<a hidden class=anchor aria-hidden=true href=#the-right-metric-depends-on-the-context>#</a></h2><p>False positives might be more important in hiring- where the error of hiring the wrong person is difficult to correct- whereas false negatives are crucial in medical diagnosis. For Reach, we decided to prioritise true positive rate because we want to ensure that we extract titles equally accurately across all groups. We have decided this to avoid the hypothetical situation where we would be reinforcing a societal bias towards rewarding citations to a particular group more. Every metric is a trade off, and no one metric can capture everything. In the case of true positive rate, the metric misses out at over attribution. This is when parts of the reference which aren’t titles (e.g. names or dates) are being misclassified as titles and then spuriously matched with publications which generates false citations…</p><h2 id=the-groups>The groups<a hidden class=anchor aria-hidden=true href=#the-groups>#</a></h2><p>The last piece missing before applying our definition of fairness to our context is a decision about the groups that are relevant. These groups people usually focus on when looking at fairness are often around protected characteristics such as gender and race. Like the definition of fairness, the specific groups to focus on also depend on the context of the decision that is being made by the algorithm. In the case of scientific publications, we decided to start by looking in the nationalities of the authors, the publication type (e.g. journal, conference, etc), the field (e.g. sociology, genetics etc), the university and the language of publication among others. This is because we do not want to favour any particular field, university or language when attributing policy citations.</p><h2 id=the-findings-some-limitations-and-iterations-for-the-future>The findings, some limitations and iterations for the future<a hidden class=anchor aria-hidden=true href=#the-findings-some-limitations-and-iterations-for-the-future>#</a></h2><p>When we did the analysis, there was no sign of bias in any of the groups we had chosen because the difference in true positive rate was negligible. There was a noticeable difference of ~3% favouring English publications which is not very surprising given that most of the training data were in English. We did not consider this difference was important to act upon, but the fact that we could detect it was a positive sign.</p><p>There are more things that we would like to review and improve in our evaluations of fairness. For example, the dataset on top of which we did the review was not independent nor balanced for the groups we were testing which means that our estimates for some groups are based on very small sample sizes. At the same time the dataset had already been ‘seen’ by the algorithm when we were training it. In future, it is more appropriate to calculate our metrics on an independent test set. We have also only evaluated one component of our machine learning pipeline and we know that attributing citations is a complex system that would be better evaluated end to end. One other thing to note is that evaluating some groups might require us to use yet another machine learning model to predict something like language, which would then need to be evaluated independently for its own biases to make sure we are reaching the right conclusions.</p><p>We are still in the early days of working out the details of how to embed ethics in an agile team in order to reduce the risk of negative consequences from the digital products we built but we feel we have learned a lot just by devoting the time and energy to think and do this. We will be sharing more from this journey as we refine these processes and do more evaluations. In the meantime if you have any questions or comments do not hesitate to get in touch.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://nsorros.github.io/tags/machine-learning/>machine learning</a></li><li><a href=https://nsorros.github.io/tags/fairness/>fairness</a></li></ul><nav class=paginav><a class=next href=https://nsorros.github.io/posts/to-predict-or-to-explain/><span class=title>Next »</span><br><span>To Predict or to Explain</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://nsorros.github.io>Nick Sorros</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>